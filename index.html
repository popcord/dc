<!DOCTYPE html>
<html>
    <head>
        <title>Discord Guild Limit Checker</title>
        <style>
            * {
                font-size: 2.5vw;
                text-align: center;
                background-color: #131418;
                color: #dfdfdf;
            }

            #login {
                border-color: rgba(255, 255, 255, .1);
                background-color: rgba(255, 255, 255, .05) !important;
            }

            .guild {
                display: inline-block;
                width: 300px;
                height: 100px;
                margin: 10px;
                padding: 10px;
                border: 1px solid #dfdfdf;
                border-radius: 10px;
                box-sizing: border-box;
                background-color: rgba(255, 255, 255, .1);
                color: #dfdfdf;
            }

            .guild img {
                width: 50px;
                height: 50px;
                vertical-align: middle;
                margin-right: 10px;
            }

            .guild h2 {
                font-size: 2.5vw;
                margin: 0;
            }
        </style>
    </head>
    <body>
        <p id="result">Redirecting...</p>
        <input id="logout" type="hidden" value="Log out" onclick="logout()">

        <div id="guilds"></div>

        <script>
            function logout() {
                document.cookie = "token=; expires=Thu, 01 Jan 1970 00:00:00 GMT";
                location = "https://discord.com/api/oauth2/authorize?response_type=token&client_id=1025753614767099945&scope=identify%20guilds";
            }

            const get = async (endpoint, token) => {
                const response = await fetch("https://discord.com/api/v9/" + endpoint, {
                    headers: {
                        "Authorization": "Bearer " + token
                    }
                });
                return response.json();
            }

            function getCookie(name) {
                var val = document.cookie.replace("/(?:(?:^|.*;\s*)"+name+"\s*\=\s*([^;]*).*$)|^.*$/", "$1");
                if (val) return val.split(name+"=").pop();
                else return null;
            }

            function setCookie(name, value, maxage) {
                document.cookie = name + "=" + value +"; max-age=" + maxage;
            }

function checkGuilds(token) {
    document.getElementById("logout").type = "button";
    document.getElementById("result").innerHTML = "Fetching data...";
    let max = 100;
    get("users/@me", token).then(user => {
        if (user.premium_type === 2) max = 200;
    });
    get("users/@me/guilds", token).then(async response => {
        let num = response.length;
        let guildList = document.createElement("ul");
        for (let i = 0; i < response.length; i++) {
            let guild = response[i];
            let guildItem = document.createElement("li");
            let guildName = document.createElement("span");
            guildName.innerText = guild.name;
            guildItem.appendChild(guildName);
            if (guild.icon) {
                let guildIcon = document.createElement("img");
                guildIcon.src = "https://cdn.discordapp.com/icons/" + guild.id + "/" + guild.icon + ".png";
                guildIcon.alt = guild.name + " icon";
                guildIcon.style.maxWidth = "50px";
                guildItem.appendChild(guildIcon);
            }
            guildList.appendChild(guildItem);
        }
        document.getElementById("result").innerHTML = "You are in " + num + "/" + max + " guilds:";
        document.getElementById("result").appendChild(guildList);
    });
}

        </script>
    </body>
</html>
